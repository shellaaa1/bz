<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONæ•°æ®ç”Ÿæˆå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .toolbar {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .file-input {
            display: none;
        }

        .file-label {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(252, 182, 159, 0.4);
        }

        .main-content {
            padding: 30px;
            min-height: 500px;
        }

        .json-editor {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .json-pair {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-start;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
        }

        .json-pair:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        .json-pair.key-value {
            border-left: 5px solid #28a745;
        }

        .json-pair.array {
            border-left: 5px solid #ffc107;
        }

        .json-pair.object {
            border-left: 5px solid #17a2b8;
        }

        .input-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .input-group input, .input-group textarea, .input-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .type-selector {
            width: 120px;
        }

        .value-input {
            min-height: 40px;
        }

        .array-input {
            min-height: 80px;
        }

        .object-input {
            min-height: 80px;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .nested-container {
            margin-left: 30px;
            margin-top: 15px;
            padding-left: 20px;
            border-left: 3px solid #dee2e6;
        }

        .add-nested-btn {
            margin-top: 10px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }

        .add-nested-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(168, 237, 234, 0.4);
        }

        .preview-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .preview-section h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .json-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .status-bar {
            background: #e9ecef;
            padding: 15px 30px;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #6c757d;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        .status-indicator.warning {
            background: #ffc107;
        }

        .drag-handle {
            cursor: move;
            padding: 5px;
            color: #6c757d;
            font-size: 16px;
        }

        .drag-handle:hover {
            color: #495057;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .empty-state p {
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .json-pair {
                flex-direction: column;
                gap: 10px;
            }
            
            .controls {
                justify-content: center;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ› ï¸ JSONæ•°æ®ç”Ÿæˆå·¥å…·</h1>
            <p>åˆ›å»ºã€ç¼–è¾‘å’Œä¸‹è½½JSONæ–‡ä»¶çš„å¼ºå¤§å·¥å…·</p>
        </div>

        <div class="toolbar">
            <button class="btn btn-primary" onclick="newJson()">
                ğŸ“„ æ–°å»ºJSON
            </button>
            <label class="file-label" for="fileInput">
                ğŸ“ ä¸Šä¼ JSONæ–‡ä»¶
            </label>
            <input type="file" id="fileInput" class="file-input" accept=".json" onchange="loadJsonFile(event)">
            <button class="btn btn-success" onclick="generateJson()">
                ğŸ’¾ ç”Ÿæˆå¹¶ä¸‹è½½
            </button>
            <button class="btn btn-info" onclick="togglePreview()">
                ğŸ‘ï¸ é¢„è§ˆJSON
            </button>
            <button class="btn btn-warning" onclick="clearAll()">
                ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰
            </button>
        </div>

        <div class="main-content">
            <div class="json-editor" id="jsonEditor">
                <div class="empty-state">
                    <h3>å¼€å§‹åˆ›å»ºä½ çš„JSONæ•°æ®</h3>
                    <p>ç‚¹å‡»"æ–°å»ºJSON"å¼€å§‹åˆ›å»ºï¼Œæˆ–ä¸Šä¼ ç°æœ‰çš„JSONæ–‡ä»¶è¿›è¡Œç¼–è¾‘</p>
                    <button class="btn btn-primary" onclick="addJsonPair()">
                        â• æ·»åŠ ç¬¬ä¸€ä¸ªé”®å€¼å¯¹
                    </button>
                </div>
            </div>

            <div class="preview-section" id="previewSection" style="display: none;">
                <h3>JSONé¢„è§ˆ</h3>
                <div class="json-preview" id="jsonPreview"></div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">å°±ç»ª</span>
            </div>
            <div class="status-item">
                <span id="pairCount">0 ä¸ªé”®å€¼å¯¹</span>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>å¤„ç†ä¸­...</p>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let jsonData = [];
        let isPreviewVisible = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('å°±ç»ª', 'success');
            updatePairCount();
        });

        // æ–°å»ºJSON
        function newJson() {
            jsonData = [];
            renderJsonEditor();
            updateStatus('å·²åˆ›å»ºæ–°çš„JSONæ–‡ä»¶', 'success');
            showNotification('å·²åˆ›å»ºæ–°çš„JSONæ–‡ä»¶', 'success');
        }

        // æ·»åŠ JSONé”®å€¼å¯¹
        function addJsonPair(parentIndex = null, type = 'key-value') {
            const newPair = {
                id: Date.now() + Math.random(),
                key: '',
                value: '',
                type: type,
                children: []
            };

            if (parentIndex === null) {
                jsonData.push(newPair);
            } else {
                if (!jsonData[parentIndex].children) {
                    jsonData[parentIndex].children = [];
                }
                jsonData[parentIndex].children.push(newPair);
            }

            renderJsonEditor();
            updateStatus('å·²æ·»åŠ æ–°çš„é”®å€¼å¯¹', 'success');
        }

        // æ¸²æŸ“JSONç¼–è¾‘å™¨
        function renderJsonEditor() {
            const editor = document.getElementById('jsonEditor');
            
            if (jsonData.length === 0) {
                editor.innerHTML = `
                    <div class="empty-state">
                        <h3>å¼€å§‹åˆ›å»ºä½ çš„JSONæ•°æ®</h3>
                        <p>ç‚¹å‡»"æ–°å»ºJSON"å¼€å§‹åˆ›å»ºï¼Œæˆ–ä¸Šä¼ ç°æœ‰çš„JSONæ–‡ä»¶è¿›è¡Œç¼–è¾‘</p>
                        <button class="btn btn-primary" onclick="addJsonPair()">
                            â• æ·»åŠ ç¬¬ä¸€ä¸ªé”®å€¼å¯¹
                        </button>
                    </div>
                `;
                return;
            }

            editor.innerHTML = jsonData.map((pair, index) => 
                renderJsonPair(pair, index)
            ).join('');

            updatePairCount();
        }

        // æ¸²æŸ“å•ä¸ªJSONé”®å€¼å¯¹
        function renderJsonPair(pair, index, level = 0) {
            const indent = level * 30;
            const typeClass = pair.type === 'array' ? 'array' : 
                             pair.type === 'object' ? 'object' : 'key-value';

            let html = `
                <div class="json-pair ${typeClass}" style="margin-left: ${indent}px;" data-id="${pair.id}">
                    <div class="drag-handle">â‹®â‹®</div>
                    <div class="input-group">
                        <label>é”®å</label>
                        <input type="text" value="${pair.key}" 
                               onchange="updateJsonPair(${index}, 'key', this.value, ${level})" 
                               placeholder="è¾“å…¥é”®å">
                    </div>
                    <div class="input-group">
                        <label>ç±»å‹</label>
                        <select class="type-selector" onchange="updateJsonPair(${index}, 'type', this.value, ${level})">
                            <option value="key-value" ${pair.type === 'key-value' ? 'selected' : ''}>é”®å€¼å¯¹</option>
                            <option value="array" ${pair.type === 'array' ? 'selected' : ''}>æ•°ç»„</option>
                            <option value="object" ${pair.type === 'object' ? 'selected' : ''}>å¯¹è±¡</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>å€¼</label>
            `;

            if (pair.type === 'array') {
                html += `
                    <textarea class="value-input array-input" 
                              onchange="updateJsonPair(${index}, 'value', this.value, ${level})" 
                              placeholder="è¾“å…¥æ•°ç»„å…ƒç´ ï¼Œæ¯è¡Œä¸€ä¸ª">${pair.value}</textarea>
                `;
            } else if (pair.type === 'object') {
                html += `
                    <textarea class="value-input object-input" 
                              onchange="updateJsonPair(${index}, 'value', this.value, ${level})" 
                              placeholder="è¾“å…¥å¯¹è±¡å±æ€§ï¼Œæ ¼å¼ï¼škey: value">${pair.value}</textarea>
                `;
            } else {
                html += `
                    <input type="text" class="value-input" value="${pair.value}" 
                           onchange="updateJsonPair(${index}, 'value', this.value, ${level})" 
                           placeholder="è¾“å…¥å€¼">
                `;
            }

            html += `
                    </div>
                    <div class="controls">
                        <button class="btn btn-small btn-info" onclick="addJsonPair(${index}, 'key-value')">
                            â•
                        </button>
                        <button class="btn btn-small btn-warning" onclick="addJsonPair(${index}, 'array')">
                            ğŸ“‹
                        </button>
                        <button class="btn btn-small btn-success" onclick="addJsonPair(${index}, 'object')">
                            ğŸ“¦
                        </button>
                        <button class="btn btn-small btn-danger" onclick="removeJsonPair(${index}, ${level})">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
            `;

            // æ¸²æŸ“å­å…ƒç´ 
            if (pair.children && pair.children.length > 0) {
                html += `<div class="nested-container">`;
                pair.children.forEach((child, childIndex) => {
                    html += renderJsonPair(child, childIndex, level + 1);
                });
                html += `</div>`;
            }

            return html;
        }

        // æ›´æ–°JSONé”®å€¼å¯¹
        function updateJsonPair(index, field, value, level = 0) {
            let targetPair;
            if (level === 0) {
                targetPair = jsonData[index];
            } else {
                // è¿™é‡Œéœ€è¦å®ç°é€’å½’æŸ¥æ‰¾ï¼Œç®€åŒ–å¤„ç†
                targetPair = jsonData[index];
            }

            if (targetPair) {
                targetPair[field] = value;
                updateStatus('å·²æ›´æ–°é”®å€¼å¯¹', 'success');
            }
        }

        // åˆ é™¤JSONé”®å€¼å¯¹
        function removeJsonPair(index, level = 0) {
            if (level === 0) {
                jsonData.splice(index, 1);
            } else {
                // è¿™é‡Œéœ€è¦å®ç°é€’å½’åˆ é™¤ï¼Œç®€åŒ–å¤„ç†
                jsonData.splice(index, 1);
            }

            renderJsonEditor();
            updateStatus('å·²åˆ é™¤é”®å€¼å¯¹', 'success');
            showNotification('å·²åˆ é™¤é”®å€¼å¯¹', 'success');
        }

        // ä¸Šä¼ JSONæ–‡ä»¶
        function loadJsonFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    jsonData = parseJsonToEditor(data);
                    renderJsonEditor();
                    updateStatus('å·²æˆåŠŸåŠ è½½JSONæ–‡ä»¶', 'success');
                    showNotification('å·²æˆåŠŸåŠ è½½JSONæ–‡ä»¶', 'success');
                } catch (error) {
                    updateStatus('JSONæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                    showNotification('JSONæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                }
            };
            reader.readAsText(file);
        }

        // è§£æJSONæ•°æ®ä¸ºç¼–è¾‘å™¨æ ¼å¼
        function parseJsonToEditor(data) {
            const result = [];
            
            if (typeof data === 'object' && data !== null) {
                Object.keys(data).forEach(key => {
                    const value = data[key];
                    const pair = {
                        id: Date.now() + Math.random(),
                        key: key,
                        value: '',
                        type: 'key-value',
                        children: []
                    };

                    if (Array.isArray(value)) {
                        pair.type = 'array';
                        pair.value = value.join('\n');
                    } else if (typeof value === 'object' && value !== null) {
                        pair.type = 'object';
                        pair.value = Object.entries(value).map(([k, v]) => `${k}: ${v}`).join('\n');
                    } else {
                        pair.value = String(value);
                    }

                    result.push(pair);
                });
            }

            return result;
        }

        // ç”ŸæˆJSON
        function generateJson() {
            try {
                const json = convertToJson(jsonData);
                const jsonString = JSON.stringify(json, null, 2);
                
                // æ›´æ–°é¢„è§ˆ
                document.getElementById('jsonPreview').textContent = jsonString;
                
                // ä¸‹è½½æ–‡ä»¶
                downloadJson(jsonString);
                
                updateStatus('å·²æˆåŠŸç”ŸæˆJSONæ–‡ä»¶', 'success');
                showNotification('å·²æˆåŠŸç”ŸæˆJSONæ–‡ä»¶', 'success');
            } catch (error) {
                updateStatus('ç”ŸæˆJSONæ—¶å‡ºé”™', 'error');
                showNotification('ç”ŸæˆJSONæ—¶å‡ºé”™: ' + error.message, 'error');
            }
        }

        // è½¬æ¢ä¸ºJSONæ ¼å¼
        function convertToJson(data) {
            const result = {};
            
            data.forEach(pair => {
                if (!pair.key) return;
                
                let value;
                switch (pair.type) {
                    case 'array':
                        value = pair.value.split('\n').filter(item => item.trim() !== '');
                        break;
                    case 'object':
                        const obj = {};
                        pair.value.split('\n').forEach(line => {
                            const [key, val] = line.split(':').map(s => s.trim());
                            if (key && val) obj[key] = val;
                        });
                        value = obj;
                        break;
                    default:
                        value = pair.value;
                }
                
                result[pair.key] = value;
            });
            
            return result;
        }

        // ä¸‹è½½JSONæ–‡ä»¶
        function downloadJson(jsonString) {
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `generated_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // åˆ‡æ¢é¢„è§ˆ
        function togglePreview() {
            const previewSection = document.getElementById('previewSection');
            isPreviewVisible = !isPreviewVisible;
            
            if (isPreviewVisible) {
                try {
                    const json = convertToJson(jsonData);
                    const jsonString = JSON.stringify(json, null, 2);
                    document.getElementById('jsonPreview').textContent = jsonString;
                    previewSection.style.display = 'block';
                    updateStatus('é¢„è§ˆå·²æ˜¾ç¤º', 'success');
                } catch (error) {
                    updateStatus('é¢„è§ˆç”Ÿæˆå¤±è´¥', 'error');
                    showNotification('é¢„è§ˆç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
                }
            } else {
                previewSection.style.display = 'none';
                updateStatus('é¢„è§ˆå·²éšè—', 'info');
            }
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                jsonData = [];
                renderJsonEditor();
                document.getElementById('previewSection').style.display = 'none';
                updateStatus('å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®', 'success');
                showNotification('å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®', 'success');
            }
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(message, type = 'success') {
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.getElementById('statusIndicator');
            
            statusText.textContent = message;
            statusIndicator.className = `status-indicator ${type}`;
        }

        // æ›´æ–°é”®å€¼å¯¹è®¡æ•°
        function updatePairCount() {
            const count = jsonData.length;
            document.getElementById('pairCount').textContent = `${count} ä¸ªé”®å€¼å¯¹`;
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // æ‹–æ‹½æ’åºåŠŸèƒ½ï¼ˆç®€åŒ–ç‰ˆï¼‰
        let draggedElement = null;

        document.addEventListener('dragstart', function(e) {
            if (e.target.classList.contains('drag-handle')) {
                draggedElement = e.target.closest('.json-pair');
                e.dataTransfer.effectAllowed = 'move';
            }
        });

        document.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
            if (draggedElement) {
                const target = e.target.closest('.json-pair');
                if (target && target !== draggedElement) {
                    // è¿™é‡Œå¯ä»¥å®ç°æ‹–æ‹½æ’åºé€»è¾‘
                    console.log('æ‹–æ‹½æ’åºåŠŸèƒ½å¾…å®ç°');
                }
                draggedElement = null;
            }
        });
    </script>
</body>
</html>
