<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONæ•°æ®ç”Ÿæˆå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .toolbar {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .file-input {
            display: none;
        }

        .file-label {
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .file-label:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .main-content {
            padding: 30px;
        }

        .json-editor {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .json-editor h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .key-value-pair {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-start;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            position: relative;
        }

        .key-value-pair:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .key-input, .value-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .key-input:focus, .value-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .key-input {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .value-input {
            background: #f3e5f5;
            border-color: #9c27b0;
        }

        .array-input {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .object-input {
            background: #e8f5e8;
            border-color: #4caf50;
        }

        .pair-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .nested-container {
            margin-left: 30px;
            padding-left: 20px;
            border-left: 3px solid #667eea;
            margin-top: 10px;
        }

        .nested-level {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .level-indicator {
            font-size: 12px;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .type-selector {
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 12px;
            background: white;
            cursor: pointer;
        }

        .preview-panel {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .preview-panel h3 {
            color: #f7fafc;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 15px 30px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #6c757d;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        .status-indicator.warning {
            background: #ffc107;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .template-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .template-item {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .template-item h4 {
            margin-bottom: 8px;
            color: #495057;
        }

        .template-item p {
            font-size: 12px;
            color: #6c757d;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .key-value-pair {
                flex-direction: column;
                gap: 10px;
            }
            
            .pair-controls {
                justify-content: center;
            }
            
            .nested-container {
                margin-left: 15px;
                padding-left: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ› ï¸ JSONæ•°æ®ç”Ÿæˆå·¥å…·</h1>
            <p>åˆ›å»ºã€ç¼–è¾‘å’Œå¯¼å‡ºJSONæ•°æ®çš„å¼ºå¤§å·¥å…·</p>
        </div>

        <div class="toolbar">
            <button class="btn btn-primary" onclick="newJson()">
                ğŸ“„ æ–°å»ºJSON
            </button>
            <label class="file-label">
                ğŸ“ ä¸Šä¼ JSONæ–‡ä»¶
                <input type="file" class="file-input" id="fileInput" accept=".json" onchange="loadJsonFile(event)">
            </label>
            <button class="btn btn-success" onclick="addKeyValuePair()">
                â• æ·»åŠ é”®å€¼å¯¹
            </button>
            <button class="btn btn-warning" onclick="showTemplates()">
                ğŸ“‹ æ¨¡æ¿åº“
            </button>
            <button class="btn btn-primary" onclick="generateJson()">
                â¬‡ï¸ ç”Ÿæˆå¹¶ä¸‹è½½
            </button>
            <button class="btn btn-secondary" onclick="previewJson()">
                ğŸ‘ï¸ é¢„è§ˆJSON
            </button>
            <button class="btn btn-danger" onclick="clearAll()">
                ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰
            </button>
        </div>

        <div class="main-content">
            <div class="json-editor" id="jsonEditor">
                <h3>ğŸ“ JSONç¼–è¾‘å™¨</h3>
                <div id="keyValuePairs">
                    <!-- é”®å€¼å¯¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="preview-panel" id="previewPanel" style="display: none;">
                <h3>ğŸ‘ï¸ JSONé¢„è§ˆ</h3>
                <div id="jsonPreview"></div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">å°±ç»ª</span>
            </div>
            <div class="status-item">
                <span>é”®å€¼å¯¹æ•°é‡: <span id="pairCount">0</span></span>
            </div>
            <div class="status-item">
                <span>åµŒå¥—å±‚çº§: <span id="nestLevel">0</span></span>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡† -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“‹ é€‰æ‹©JSONæ¨¡æ¿</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="template-list" id="templateList">
                <!-- æ¨¡æ¿åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>

    <script>
        let jsonData = {};
        let pairCounter = 0;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
            addKeyValuePair(); // æ·»åŠ ç¬¬ä¸€ä¸ªé”®å€¼å¯¹
        });

        // æ–°å»ºJSON
        function newJson() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰æ•°æ®å¹¶åˆ›å»ºæ–°çš„JSONå—ï¼Ÿ')) {
                jsonData = {};
                document.getElementById('keyValuePairs').innerHTML = '';
                pairCounter = 0;
                addKeyValuePair();
                updateStatus();
                showNotification('å·²åˆ›å»ºæ–°çš„JSONæ–‡ä»¶', 'success');
            }
        }

        // æ·»åŠ é”®å€¼å¯¹
        function addKeyValuePair(parentId = null) {
            const container = parentId ? 
                document.getElementById(parentId) : 
                document.getElementById('keyValuePairs');
            
            const pairId = `pair_${pairCounter++}`;
            const pairDiv = document.createElement('div');
            pairDiv.className = 'key-value-pair';
            pairDiv.id = pairId;
            
            const level = getNestLevel(container);
            const isNested = level > 0;
            
            if (isNested) {
                pairDiv.classList.add('nested-level');
                pairDiv.innerHTML = `
                    <div class="level-indicator">
                        ${'â””â”€ '.repeat(level)} åµŒå¥—å±‚çº§ ${level}
                    </div>
                `;
            }

            pairDiv.innerHTML += `
                <input type="text" class="key-input" placeholder="é”®å" onchange="updateJson()">
                <select class="type-selector" onchange="changeValueType(this)">
                    <option value="string">å­—ç¬¦ä¸²</option>
                    <option value="number">æ•°å­—</option>
                    <option value="boolean">å¸ƒå°”å€¼</option>
                    <option value="array">æ•°ç»„</option>
                    <option value="object">å¯¹è±¡</option>
                </select>
                <input type="text" class="value-input" placeholder="å€¼" onchange="updateJson()">
                <div class="pair-controls">
                    <button class="btn btn-success btn-small" onclick="addNestedPair('${pairId}')" title="æ·»åŠ åµŒå¥—é”®å€¼å¯¹">
                        â•
                    </button>
                    <button class="btn btn-warning btn-small" onclick="addArrayItem('${pairId}')" title="æ·»åŠ æ•°ç»„é¡¹">
                        ğŸ“‹
                    </button>
                    <button class="btn btn-danger btn-small" onclick="removePair('${pairId}')" title="åˆ é™¤">
                        ğŸ—‘ï¸
                    </button>
                </div>
            `;

            container.appendChild(pairDiv);
            updateStatus();
        }

        // æ·»åŠ åµŒå¥—é”®å€¼å¯¹
        function addNestedPair(parentId) {
            const parentDiv = document.getElementById(parentId);
            let nestedContainer = parentDiv.querySelector('.nested-container');
            
            if (!nestedContainer) {
                nestedContainer = document.createElement('div');
                nestedContainer.className = 'nested-container';
                parentDiv.appendChild(nestedContainer);
            }
            
            addKeyValuePair(nestedContainer.id);
        }

        // æ·»åŠ æ•°ç»„é¡¹
        function addArrayItem(parentId) {
            const parentDiv = document.getElementById(parentId);
            const typeSelector = parentDiv.querySelector('.type-selector');
            typeSelector.value = 'array';
            
            let arrayContainer = parentDiv.querySelector('.array-container');
            if (!arrayContainer) {
                arrayContainer = document.createElement('div');
                arrayContainer.className = 'array-container';
                arrayContainer.style.marginTop = '10px';
                arrayContainer.style.paddingLeft = '20px';
                arrayContainer.style.borderLeft = '3px solid #ff9800';
                parentDiv.appendChild(arrayContainer);
            }
            
            const arrayItemDiv = document.createElement('div');
            arrayItemDiv.className = 'key-value-pair';
            arrayItemDiv.innerHTML = `
                <input type="text" class="array-input" placeholder="æ•°ç»„é¡¹" onchange="updateJson()">
                <button class="btn btn-danger btn-small" onclick="this.parentElement.remove(); updateJson()">ğŸ—‘ï¸</button>
            `;
            
            arrayContainer.appendChild(arrayItemDiv);
            updateJson();
        }

        // åˆ é™¤é”®å€¼å¯¹
        function removePair(pairId) {
            const pairDiv = document.getElementById(pairId);
            if (pairDiv) {
                pairDiv.remove();
                updateJson();
                updateStatus();
            }
        }

        // è·å–åµŒå¥—å±‚çº§
        function getNestLevel(element) {
            let level = 0;
            let parent = element.parentElement;
            while (parent && parent.classList.contains('nested-container')) {
                level++;
                parent = parent.parentElement;
            }
            return level;
        }

        // æ”¹å˜å€¼ç±»å‹
        function changeValueType(select) {
            const pairDiv = select.closest('.key-value-pair');
            const valueInput = pairDiv.querySelector('.value-input');
            const type = select.value;
            
            switch(type) {
                case 'boolean':
                    valueInput.type = 'checkbox';
                    valueInput.checked = false;
                    break;
                case 'number':
                    valueInput.type = 'number';
                    break;
                case 'string':
                default:
                    valueInput.type = 'text';
                    break;
            }
            
            updateJson();
        }

        // æ›´æ–°JSONæ•°æ®
        function updateJson() {
            jsonData = {};
            const pairs = document.querySelectorAll('.key-value-pair');
            
            pairs.forEach(pair => {
                const keyInput = pair.querySelector('.key-input');
                const valueInput = pair.querySelector('.value-input');
                const typeSelector = pair.querySelector('.type-selector');
                
                if (keyInput && keyInput.value.trim()) {
                    const key = keyInput.value.trim();
                    let value = valueInput.value;
                    
                    // æ ¹æ®ç±»å‹å¤„ç†å€¼
                    if (typeSelector) {
                        switch(typeSelector.value) {
                            case 'number':
                                value = parseFloat(value) || 0;
                                break;
                            case 'boolean':
                                value = valueInput.checked;
                                break;
                            case 'array':
                                value = getArrayValues(pair);
                                break;
                            case 'object':
                                value = getObjectValues(pair);
                                break;
                        }
                    }
                    
                    jsonData[key] = value;
                }
            });
            
            updateStatus();
        }

        // è·å–æ•°ç»„å€¼
        function getArrayValues(pair) {
            const arrayContainer = pair.querySelector('.array-container');
            if (!arrayContainer) return [];
            
            const arrayItems = arrayContainer.querySelectorAll('.array-input');
            return Array.from(arrayItems).map(item => item.value.trim()).filter(item => item);
        }

        // è·å–å¯¹è±¡å€¼
        function getObjectValues(pair) {
            const nestedContainer = pair.querySelector('.nested-container');
            if (!nestedContainer) return {};
            
            const obj = {};
            const nestedPairs = nestedContainer.querySelectorAll('.key-value-pair');
            
            nestedPairs.forEach(nestedPair => {
                const keyInput = nestedPair.querySelector('.key-input');
                const valueInput = nestedPair.querySelector('.value-input');
                
                if (keyInput && keyInput.value.trim()) {
                    obj[keyInput.value.trim()] = valueInput.value;
                }
            });
            
            return obj;
        }

        // ä¸Šä¼ JSONæ–‡ä»¶
        function loadJsonFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    loadJsonData(data);
                    showNotification('JSONæ–‡ä»¶åŠ è½½æˆåŠŸ', 'success');
                } catch (error) {
                    showNotification('JSONæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                }
            };
            reader.readAsText(file);
        }

        // åŠ è½½JSONæ•°æ®åˆ°ç¼–è¾‘å™¨
        function loadJsonData(data, container = null) {
            const targetContainer = container || document.getElementById('keyValuePairs');
            targetContainer.innerHTML = '';
            pairCounter = 0;
            
            Object.entries(data).forEach(([key, value]) => {
                addKeyValuePairFromData(targetContainer, key, value);
            });
            
            updateJson();
        }

        // ä»æ•°æ®æ·»åŠ é”®å€¼å¯¹
        function addKeyValuePairFromData(container, key, value) {
            const pairId = `pair_${pairCounter++}`;
            const pairDiv = document.createElement('div');
            pairDiv.className = 'key-value-pair';
            pairDiv.id = pairId;
            
            let type = 'string';
            if (typeof value === 'number') type = 'number';
            else if (typeof value === 'boolean') type = 'boolean';
            else if (Array.isArray(value)) type = 'array';
            else if (typeof value === 'object' && value !== null) type = 'object';
            
            pairDiv.innerHTML = `
                <input type="text" class="key-input" value="${key}" onchange="updateJson()">
                <select class="type-selector" onchange="changeValueType(this)">
                    <option value="string" ${type === 'string' ? 'selected' : ''}>å­—ç¬¦ä¸²</option>
                    <option value="number" ${type === 'number' ? 'selected' : ''}>æ•°å­—</option>
                    <option value="boolean" ${type === 'boolean' ? 'selected' : ''}>å¸ƒå°”å€¼</option>
                    <option value="array" ${type === 'array' ? 'selected' : ''}>æ•°ç»„</option>
                    <option value="object" ${type === 'object' ? 'selected' : ''}>å¯¹è±¡</option>
                </select>
                <input type="${type === 'boolean' ? 'checkbox' : type === 'number' ? 'number' : 'text'}" 
                       class="value-input" 
                       value="${type === 'boolean' ? '' : value}" 
                       ${type === 'boolean' ? (value ? 'checked' : '') : ''}
                       onchange="updateJson()">
                <div class="pair-controls">
                    <button class="btn btn-success btn-small" onclick="addNestedPair('${pairId}')" title="æ·»åŠ åµŒå¥—é”®å€¼å¯¹">
                        â•
                    </button>
                    <button class="btn btn-warning btn-small" onclick="addArrayItem('${pairId}')" title="æ·»åŠ æ•°ç»„é¡¹">
                        ğŸ“‹
                    </button>
                    <button class="btn btn-danger btn-small" onclick="removePair('${pairId}')" title="åˆ é™¤">
                        ğŸ—‘ï¸
                    </button>
                </div>
            `;
            
            container.appendChild(pairDiv);
            
            // å¤„ç†æ•°ç»„å’Œå¯¹è±¡ç±»å‹
            if (type === 'array' && Array.isArray(value)) {
                addArrayItemsFromData(pairDiv, value);
            } else if (type === 'object' && typeof value === 'object' && value !== null) {
                addObjectItemsFromData(pairDiv, value);
            }
        }

        // ä»æ•°æ®æ·»åŠ æ•°ç»„é¡¹
        function addArrayItemsFromData(pairDiv, arrayData) {
            const typeSelector = pairDiv.querySelector('.type-selector');
            typeSelector.value = 'array';
            
            const arrayContainer = document.createElement('div');
            arrayContainer.className = 'array-container';
            arrayContainer.style.marginTop = '10px';
            arrayContainer.style.paddingLeft = '20px';
            arrayContainer.style.borderLeft = '3px solid #ff9800';
            
            arrayData.forEach(item => {
                const arrayItemDiv = document.createElement('div');
                arrayItemDiv.className = 'key-value-pair';
                arrayItemDiv.innerHTML = `
                    <input type="text" class="array-input" value="${item}" onchange="updateJson()">
                    <button class="btn btn-danger btn-small" onclick="this.parentElement.remove(); updateJson()">ğŸ—‘ï¸</button>
                `;
                arrayContainer.appendChild(arrayItemDiv);
            });
            
            pairDiv.appendChild(arrayContainer);
        }

        // ä»æ•°æ®æ·»åŠ å¯¹è±¡é¡¹
        function addObjectItemsFromData(pairDiv, objectData) {
            const typeSelector = pairDiv.querySelector('.type-selector');
            typeSelector.value = 'object';
            
            const nestedContainer = document.createElement('div');
            nestedContainer.className = 'nested-container';
            nestedContainer.id = `nested_${pairCounter++}`;
            
            Object.entries(objectData).forEach(([key, value]) => {
                addKeyValuePairFromData(nestedContainer, key, value);
            });
            
            pairDiv.appendChild(nestedContainer);
        }

        // ç”Ÿæˆå¹¶ä¸‹è½½JSON
        function generateJson() {
            updateJson();
            
            if (Object.keys(jsonData).length === 0) {
                showNotification('è¯·å…ˆæ·»åŠ ä¸€äº›æ•°æ®', 'warning');
                return;
            }
            
            const jsonString = JSON.stringify(jsonData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `generated_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('JSONæ–‡ä»¶å·²ä¸‹è½½', 'success');
        }

        // é¢„è§ˆJSON
        function previewJson() {
            updateJson();
            const previewPanel = document.getElementById('previewPanel');
            const jsonPreview = document.getElementById('jsonPreview');
            
            if (Object.keys(jsonData).length === 0) {
                jsonPreview.textContent = 'æš‚æ— æ•°æ®';
            } else {
                jsonPreview.textContent = JSON.stringify(jsonData, null, 2);
            }
            
            previewPanel.style.display = 'block';
        }

        // æ˜¾ç¤ºæ¨¡æ¿åº“
        function showTemplates() {
            const templates = [
                {
                    name: 'ç”¨æˆ·ä¿¡æ¯',
                    description: 'åŒ…å«åŸºæœ¬ç”¨æˆ·ä¿¡æ¯çš„JSONæ¨¡æ¿',
                    data: {
                        "name": "å¼ ä¸‰",
                        "age": 25,
                        "email": "zhangsan@example.com",
                        "address": {
                            "city": "åŒ—äº¬",
                            "street": "æœé˜³åŒº"
                        },
                        "hobbies": ["è¯»ä¹¦", "æ¸¸æ³³", "ç¼–ç¨‹"]
                    }
                },
                {
                    name: 'äº§å“ä¿¡æ¯',
                    description: 'ç”µå•†äº§å“ä¿¡æ¯æ¨¡æ¿',
                    data: {
                        "productId": "P001",
                        "name": "æ™ºèƒ½æ‰‹æœº",
                        "price": 2999.99,
                        "category": "ç”µå­äº§å“",
                        "specifications": {
                            "brand": "Apple",
                            "model": "iPhone 15",
                            "storage": "128GB"
                        },
                        "tags": ["æ–°å“", "çƒ­é”€", "æ¨è"]
                    }
                },
                {
                    name: 'é…ç½®ä¿¡æ¯',
                    description: 'åº”ç”¨ç¨‹åºé…ç½®æ¨¡æ¿',
                    data: {
                        "appName": "MyApp",
                        "version": "1.0.0",
                        "debug": false,
                        "database": {
                            "host": "localhost",
                            "port": 5432,
                            "name": "myapp_db"
                        },
                        "features": {
                            "darkMode": true,
                            "notifications": true,
                            "autoSave": false
                        }
                    }
                }
            ];
            
            const templateList = document.getElementById('templateList');
            templateList.innerHTML = '';
            
            templates.forEach(template => {
                const templateItem = document.createElement('div');
                templateItem.className = 'template-item';
                templateItem.onclick = () => loadTemplate(template.data);
                templateItem.innerHTML = `
                    <h4>${template.name}</h4>
                    <p>${template.description}</p>
                `;
                templateList.appendChild(templateItem);
            });
            
            document.getElementById('templateModal').style.display = 'block';
        }

        // åŠ è½½æ¨¡æ¿
        function loadTemplate(data) {
            if (confirm('ç¡®å®šè¦åŠ è½½æ­¤æ¨¡æ¿å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®ã€‚')) {
                loadJsonData(data);
                closeModal();
                showNotification('æ¨¡æ¿åŠ è½½æˆåŠŸ', 'success');
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('templateModal').style.display = 'none';
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                jsonData = {};
                document.getElementById('keyValuePairs').innerHTML = '';
                pairCounter = 0;
                addKeyValuePair();
                updateStatus();
                showNotification('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
            }
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus() {
            const pairs = document.querySelectorAll('.key-value-pair');
            const pairCount = pairs.length;
            const maxLevel = Math.max(...Array.from(pairs).map(pair => getNestLevel(pair)));
            
            document.getElementById('pairCount').textContent = pairCount;
            document.getElementById('nestLevel').textContent = maxLevel;
            
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (pairCount === 0) {
                statusIndicator.className = 'status-indicator warning';
                statusText.textContent = 'æ— æ•°æ®';
            } else if (Object.keys(jsonData).length > 0) {
                statusIndicator.className = 'status-indicator';
                statusText.textContent = 'æ•°æ®æœ‰æ•ˆ';
            } else {
                statusIndicator.className = 'status-indicator error';
                statusText.textContent = 'æ•°æ®æ— æ•ˆ';
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('templateModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 'n':
                        event.preventDefault();
                        newJson();
                        break;
                    case 's':
                        event.preventDefault();
                        generateJson();
                        break;
                    case 'p':
                        event.preventDefault();
                        previewJson();
                        break;
                }
            }
        });
    </script>
</body>
</html>
